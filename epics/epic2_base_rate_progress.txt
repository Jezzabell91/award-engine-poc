# Progress Log - Epic 2: Base Rate & Casual Loading Calculation

This file tracks progress across Ralph iterations. Each iteration should APPEND a new entry below.

Format:
```
## Iteration N - [TIMESTAMP]
**Task:** [User Story ID and description]
**Actions Taken:**
- [Action 1]
- [Action 2]
**Result:** [PASS/FAIL/PARTIAL]
**Notes:** [Any observations or issues]
**Commit:** [Git commit hash if applicable]
```

---

## Progress Entries

<!-- Ralph: Append your progress below this line. Do not modify entries above. -->

## Iteration 1 - 2026-01-22
**Task:** US-2.1 - Base Rate Lookup
**Actions Taken:**
- Created `src/calculation/mod.rs` module for calculation logic
- Created `src/calculation/base_rate.rs` with `get_base_rate` function
- Implemented `BaseRateLookupResult` struct with rate and audit step
- Added support for employee override rates (takes precedence)
- Added config lookup by classification code and effective date
- Returns `ClassificationNotFound` error for unknown classifications
- Returns `RateNotFound` error when no rate exists for the effective date
- Audit step records rule_id: 'base_rate_lookup', clause_ref: '14.2'
- Audit step input includes classification_code, output includes determined rate
- Added `Penalties` and `OvertimeSection` to config module exports
- Wrote tests for all 4 test cases (BR-001 through BR-004)
- All tests pass, clippy produces no warnings
**Result:** PASS
**Notes:** All acceptance criteria met. Function signature includes step_number parameter for proper audit trail sequencing.
**Commit:** (pending)

## Iteration 2 - 2026-01-22
**Task:** US-2.2 - Casual Loading Application
**Actions Taken:**
- Created `src/calculation/casual_loading.rs` with `apply_casual_loading` function
- Implemented `CasualLoadingResult` struct with loaded_rate and audit step
- Created `casual_loading_multiplier()` function returning Decimal 1.25
- Applies 25% loading (multiplier 1.25) for casual employees
- Returns unchanged rate for FullTime and PartTime employees
- Audit step records rule_id: 'casual_loading', clause_ref: '10.4(b)'
- Audit step input includes base_rate and employment_type
- Audit step output includes loaded_rate and loading_applied flag
- Audit reasoning explains calculation (e.g., '$28.54 x 1.25 = $35.675')
- Used Decimal::normalize() for consistent string representation in audit
- Exported new types from calculation module
- Wrote tests for all 5 test cases (CL-001 through CL-005)
- All 85 tests pass, clippy produces no warnings
**Result:** PASS
**Notes:** All acceptance criteria met. Used function instead of const for multiplier to avoid requiring rust_decimal_macros crate.
**Commit:** (pending)

## Iteration 3 - 2026-01-22
**Task:** US-2.3 - Ordinary Hours Calculation
**Actions Taken:**
- Created `src/calculation/ordinary_hours.rs` with `calculate_ordinary_hours` function
- Implemented `OrdinaryHoursResult` struct with pay_line and audit_steps
- Function calculates ordinary pay by:
  1. Looking up base rate from config or employee override
  2. Applying casual loading if employee is casual
  3. Generating PayLine with calculated amount
- PayLine has category `Ordinary` for FullTime/PartTime, `OrdinaryCasual` for Casual
- PayLine.hours equals shift.worked_hours()
- PayLine.rate is the effective rate (base_rate * multiplier for casuals)
- PayLine.amount = hours * effective_rate
- PayLine.clause_ref references "22.1" (ordinary hours clause)
- Audit trace includes 3 steps in order:
  1. base_rate_lookup (clause 14.2)
  2. casual_loading (clause 10.4(b))
  3. ordinary_hours_calculation (clause 22.1)
- Audit step input includes shift_id, hours, base_rate, effective_rate, employment_type, multiplier
- Exported new types from calculation module
- Wrote tests for all 5 test cases (OH-001 through OH-005)
- All 95 tests pass, clippy produces no warnings
**Result:** PASS
**Notes:** All acceptance criteria met. The PayLine struct uses `rate` field for the effective rate (base * multiplier) rather than separate base_rate and multiplier fields. Test OH-005 calculates to 267.5625 exactly (7.5 * 35.675) rather than 267.56 as shown in PRD - kept exact calculation without rounding.
**Commit:** (pending)

